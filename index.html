<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#d4af37" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" type="image/png" href="icon-192.png">
  <title>Jurnal Trading by TradersXauusd</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{--bg:#070707;--surface:#141414;--panel:#111;--gold:#d4af37;--gold-glow:rgba(212,175,55,0.45);--muted:#9c9c9c;--profit:#00ff7f;--loss:#ff4757;--border:rgba(255,255,255,0.04)}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#060606 0%,#0c0c0c 100%);color:#e6e6e6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;min-height:100vh;position:relative;overflow-x:hidden}
.stars{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
.star{position:absolute;border-radius:50%;filter:blur(1px);opacity:.6;animation:tw 4s ease-in-out infinite alternate,move 120s linear infinite}
@keyframes tw{0%{opacity:.2;transform:scale(.6)}50%{opacity:1;transform:scale(1.15)}100%{opacity:.3;transform:scale(.8)}}
@keyframes move{from{transform:translateY(-10vh)}to{transform:translateY(110vh)}}
.wrapper{max-width:1200px;margin:18px auto;padding:0 14px;position:relative;z-index:2}
h1{font-size:2rem;text-align:center;color:var(--gold);text-shadow:0 0 10px var(--gold-glow),0 6px 30px rgba(0,0,0,0.8);margin:12px 0}
.container{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:18px;border:1px solid var(--border);box-shadow:0 12px 40px rgba(0,0,0,0.6)}
.banner-slider{max-width:728px;height:90px;margin:8px auto 20px;position:relative;border-radius:10px;overflow:hidden}
.banner-slide{position:absolute;inset:0;opacity:0;transition:opacity .9s ease;z-index:0;display:block}
.banner-slide img{width:100%;height:100%;object-fit:cover;display:block}
.banner-slide.active{opacity:1;z-index:1;display:block}
.summary-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:14px;margin-bottom:18px}
.card{background:var(--panel);padding:14px;border-radius:10px;border:1px solid var(--border);text-align:center;transition:transform .3s,box-shadow .3s;min-height:86px}
.card:hover{transform:translateY(-6px);box-shadow:0 10px 30px rgba(0,0,0,0.6)}
.card h3{color:var(--muted);font-weight:500;margin:6px 0}
.card p{font-size:1.25rem;font-weight:800;color:var(--gold);margin:2px 0}
.charts{display:flex;gap:18px;flex-wrap:wrap;align-items:stretch}
.chart-box{flex:1 1 420px;min-width:320px;background:var(--panel);border-radius:10px;padding:16px;border:1px solid var(--border);box-shadow:0 6px 30px rgba(0,0,0,0.6);height:360px;display:flex;flex-direction:column;animation:fadeZoom 1s ease-in-out forwards;opacity:0;transform:scale(0.92);overflow:hidden;justify-content:center;align-items:center}
@keyframes fadeZoom{0%{opacity:0;transform:scale(0.9)}100%{opacity:1;transform:scale(1)}}
.chart-box h3{margin:0 0 8px;color:var(--gold);text-align:center}
.chart-box canvas{flex:1;max-height:100%;width:100%!important;height:auto!important;max-height:clamp(200px,28vh,320px);display:block;object-fit:contain;margin:0 auto}
#tradeForm{background:var(--panel);border-radius:10px;padding:14px;border:1px solid var(--border);margin-top:18px}
.form-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px}
label{font-size:.9rem;color:var(--muted);margin-bottom:6px;display:block}
input,select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid var(--border);background:#171717;color:#eee}
input:focus,select:focus,textarea:focus{outline:none;box-shadow:0 0 8px var(--gold-glow);border-color:var(--gold)}
textarea{min-height:64px;resize:vertical}
.btn-row{display:flex;gap:10px;margin-top:10px}
button{cursor:pointer;padding:10px 14px;border-radius:8px;border:none;font-weight:700}
.btn-save{background:var(--gold);color:#000}
.btn-calc{background:#444;color:#fff}
.btn-clear{background:#c22323;color:#fff}
.table-wrapper{width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch;border-radius:8px;margin-top:12px}
.trade-table{width:100%;border-collapse:collapse;min-width:700px}
.trade-table th,.trade-table td{padding:10px 12px;text-align:center;color:#ffd65a;border-bottom:1px solid rgba(255,214,90,0.15)}
.trade-table th{background:#0c0c0c;font-weight:700;letter-spacing:0.3px;white-space:nowrap;position:sticky;top:0;z-index:5}
.trade-table tr:nth-child(even){background-color:rgba(255,255,255,0.02)}
@media (max-width:600px){.trade-table{min-width:550px}.trade-table th,.trade-table td{font-size:12px;padding:8px}}
.rekap{margin-top:18px;padding:14px;background:var(--panel);border-radius:10px;border:1px solid var(--border)}
.rekap .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
.rekap .controls label{margin-right:6px}
footer{padding:28px 0;text-align:center;color:var(--muted);font-size:.9rem}
.fade-in{opacity:0;transform:translateY(12px);animation:fadeIn .9s ease forwards}
.fade-in.delay-1{animation-delay:.08s}
.fade-in.delay-2{animation-delay:.16s}
.fade-in.delay-3{animation-delay:.24s}
@keyframes fadeIn{to{opacity:1;transform:none}}
@keyframes fadeRow{0%{opacity:0;transform:translateY(8px);background-color:rgba(212,175,55,0.05)}60%{opacity:0.9;transform:translateY(0);background-color:rgba(212,175,55,0.12)}100%{opacity:1;background-color:transparent}}
.trade-row{animation:fadeRow 0.6s ease forwards;transition:background-color 0.6s ease}
@media(max-width:900px){.chart-box{height:320px}.banner-slider{max-width:100%}}
@media(max-width:520px){h1{font-size:1.5rem}.chart-box{height:260px}}
@media(max-width:768px){button.btn-calc{width:100%!important;max-width:none!important;font-size:1.05rem;padding:14px 20px;border-radius:12px;margin-top:14px;text-align:center}}
@media(max-width:400px){button.btn-calc{font-size:0.95rem;padding:12px 16px}}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#222;color:#fff;padding:10px 20px;border-radius:8px;font-size:14px;opacity:0;transition:opacity 0.3s ease;z-index:9999}
.toast.show{opacity:1}
.ad-container{width:100%;text-align:center;margin:24px auto}
.support-banner{position:fixed;bottom:12px;left:50%;transform:translateX(-50%);width:min(95%,700px);background:rgba(18,18,18,0.95);backdrop-filter:blur(10px);border:1px solid rgba(255,214,90,0.25);border-radius:14px;color:#ffd65a;display:flex;align-items:center;justify-content:space-between;padding:10px 16px;font-family:"Poppins",system-ui,sans-serif;font-size:14px;z-index:99999;box-shadow:0 4px 24px rgba(0,0,0,0.7);transform:translate(-50%,150%);opacity:0;transition:transform 0.8s ease,opacity 0.8s ease}
.support-banner.show{transform:translate(-50%,0);opacity:1}
.support-banner.hide{transform:translate(-50%,150%);opacity:0}
.support-banner img{width:32px;height:32px;border-radius:6px;object-fit:cover;margin-right:10px;animation:glow 3s infinite ease-in-out}
@keyframes glow{0%,100%{box-shadow:0 0 6px #d4af37}50%{box-shadow:0 0 14px #ffd65a}}
.support-banner .text{display:flex;flex-direction:column;gap:2px;flex-grow:1}
.support-banner strong{font-weight:700;color:#ffd65a;font-size:15px}
.support-banner span{font-size:13px;color:#eee;opacity:0.85}
.support-banner .btn{background:linear-gradient(90deg,#ffd65a,#d4af37);color:#000;border:none;border-radius:10px;padding:8px 18px;font-weight:700;cursor:pointer;transition:0.25s ease}
.support-banner .btn:hover{transform:scale(1.08);box-shadow:0 0 10px #ffd65a}
@media(max-width:600px){.support-banner{flex-direction:column;text-align:center;width:92%;gap:8px;padding:12px;font-size:13px}.support-banner img{margin:0 auto 4px}.support-banner .btn{width:100%;max-width:260px;margin:0 auto}}
</style>

<script>
function showToast(msg){const toast=document.createElement('div');toast.className='toast show';toast.textContent=msg;document.body.appendChild(toast);setTimeout(()=>toast.classList.remove('show'),2000);setTimeout(()=>toast.remove(),2500)}
</script>
</head>
<body>

<div id="syncStatus" style="position:fixed;top:10px;right:10px;z-index:9999;padding:6px 14px;border-radius:12px;font-weight:600;font-size:13px;color:#000;background:#ffd65a;box-shadow:0 0 12px rgba(0,0,0,0.25);transition:all 0.3s ease;opacity:0.95">üåê Checking...</div>

<div class="stars" aria-hidden="true"></div>

<div class="wrapper">
  <div class="fade-in delay-1" style="max-width:1200px;margin:0 auto 6px">
    <div class="tradingview-widget-container">
      <div class="tradingview-widget-container__widget"></div>
      <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
      {"symbols":[{"proName":"FOREXCOM:XAUUSD","title":"XAUUSD"},{"proName":"FX:EURUSD","title":"EURUSD"},{"proName":"FX:GBPUSD","title":"GBPUSD"},{"proName":"FX:USDJPY","title":"USDJPY"},{"proName":"CAPITALCOM:DXY","title":"DXY"}],"colorTheme":"dark","isTransparent":false,"displayMode":"adaptive","locale":"en"}
      </script>
    </div>
  </div>

  <h1 class="fade-in delay-2">üìà Jurnal Trading by TradersXauusd</h1>

  <div class="container fade-in delay-3">
    <div class="banner-slider fade-in" id="bannerSlider">
      <div class="banner-slide active">
        <a href="https://clicks.pipaffiliates.com/c?m=145483&c=1062011" target="_blank" rel="noopener noreferrer">
          <img src="https://ads.pipaffiliates.com/i/145483?c=1062011" alt="XM">
        </a>
      </div>
      <div class="banner-slide">
        <a href="https://one.exnessonelink.com/intl/en/a/6ctf9tyym5" target="_blank" rel="noopener noreferrer">
          <img src="https://d3dpet1g0ty5ed.cloudfront.net/EN_625k_traders_choose_Exness_720x90.png" alt="Exness">
        </a>
      </div>
    </div>

    <div class="summary-row fade-in">
      <div class="card"><h3>Total Pips</h3><p id="weeklyTotal">0.0</p></div>
      <div class="card"><h3>Win Rate</h3><p id="weeklyRate">0%</p></div>
      <div class="card"><h3>Total Trades</h3><p id="weeklyTrades">0</p></div>
      <div class="card"><h3>Trades Profit</h3><p id="weeklyWins">0</p></div>
      <div class="card"><h3>Trades Loss</h3><p id="weeklyLoss">0</p></div>
    </div>

    <div class="charts">
      <div class="chart-box fade-in">
        <h3>üìà Performa Mingguan</h3>
        <canvas id="weeklyChart"></canvas>
      </div>
      <div class="chart-box fade-in">
        <h3>üèÜ Win vs Loss Ratio</h3>
        <canvas id="winLossChart"></canvas>
      </div>
    </div>

    <form id="tradeForm" class="fade-in" autocomplete="off">
      <h3 style="color:var(--gold);margin:6px 0 12px">‚úèÔ∏è Input Data Trading</h3>
      <div class="form-row">
        <div><label for="tanggal">Tanggal</label><input id="tanggal" type="date"></div>
        <div><label for="pair">Pair</label><input id="pair" type="text" value="XAUUSD"></div>
        <div><label for="tipe">Tipe</label><select id="tipe"><option value="buy">Buy</option><option value="sell">Sell</option></select></div>
        <div><label for="entry">Entry</label><input id="entry" type="number" step="any" placeholder="0.0"></div>
        <div><label for="exit">Exit</label><input id="exit" type="number" step="any" placeholder="0.0"></div>
        <div><label for="pips">Pips (otomatis)</label><input id="pips" type="number" step="any" readonly placeholder="0.0"></div>
      </div>
      <div style="margin-top:10px"><label for="note">Catatan</label><textarea id="note" placeholder="Alasan entry / catatan singkat"></textarea></div>
      <div class="btn-row">
        <button type="button" id="saveTradeBtn" class="btn-save">üíæ Simpan Trade</button>
        <button type="button" class="btn-calc" id="calcBtn">üßÆ Hitung Pips</button>
        <button type="button" class="btn-clear" id="clearBtn">üóëÔ∏è Hapus Semua</button>
      </div>
    </form>

    <div class="table-wrapper fade-in">
      <table class="trade-table" aria-live="polite">
        <thead><tr><th>Tanggal</th><th>Pair</th><th>Tipe</th><th>Entry</th><th>Exit</th><th>Pips</th><th>Catatan</th><th>Aksi</th></tr></thead>
        <tbody id="tradeTable"></tbody>
      </table>
    </div>

    <div class="rekap fade-in" id="filterBox" style="margin-top:20px;text-align:center">
      <h3 style="color:var(--gold);margin-bottom:8px">üîç Filter Data Berdasarkan Tanggal</h3>
      <label for="startDate">Dari:</label><input type="date" id="startDate" style="margin-right:10px">
      <label for="endDate">Sampai:</label><input type="date" id="endDate">
      <button class="btn" id="filterBtn" style="margin-left:10px;background:var(--gold);color:#000">Terapkan</button>
      <button class="btn-clear" id="resetFilter" style="margin-left:5px">Reset</button>
    </div>

    <div class="rekap fade-in" id="rekapBox">
      <h3 style="color:var(--gold);margin:0 0 10px;text-align:center">üìÖ Rekap Bulanan</h3>
      <div class="controls" style="justify-content:center">
        <label for="monthSelect">Bulan:</label><select id="monthSelect"></select>
        <label for="yearSelect">Tahun:</label><select id="yearSelect"></select>
      </div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px">
        <div class="card"><h3>Total Pips</h3><p id="monthlyPips">0</p></div>
        <div class="card"><h3>Win Rate</h3><p id="monthlyRate">0%</p></div>
        <div class="card"><h3>Total Trades</h3><p id="monthlyTrades">0</p></div>
      </div>
    </div>

    <div id="ad-slot" class="ad-container">
      <a id="fallback-banner" href="https://tradersxauusd.my.id" target="_blank" rel="nofollow noopener noreferrer" style="display:none">
        <img src="https://ads.pipaffiliates.com/i/145483?c=1062011" alt="XM Trading Banner" style="width:100%;max-width:728px;height:auto;border-radius:8px;box-shadow:0 0 12px rgba(0,0,0,0.4)">
      </a>
    </div>

    <div class="fade-in" style="margin-top:32px;text-align:center">
      <h3 style="color:var(--gold);margin-bottom:14px">üåê Follow & Connect with TradersXauusd</h3>
      <div style="margin-bottom:16px">
        <a href="https://tradersxauusd.my.id" target="_blank" rel="noopener noreferrer" style="display:inline-block;color:var(--gold);font-weight:700;text-decoration:none;padding:12px 20px;border:1px solid var(--gold);border-radius:10px;transition:.3s;font-size:1rem">üåê Visit Website TradersXauusd.my.id</a>
      </div>
      <div style="display:flex;justify-content:center;gap:14px;flex-wrap:wrap">
        <a href="https://t.me/marketoutlooktradersxauusd" target="_blank" rel="noopener noreferrer" style="color:var(--gold);font-weight:600;text-decoration:none;padding:10px 14px;border:1px solid var(--gold);border-radius:8px;transition:.3s">üí¨ Telegram Channel</a>
        <a href="https://t.me/tradersxauusd" target="_blank" rel="noopener noreferrer" style="color:var(--gold);font-weight:600;text-decoration:none;padding:10px 14px;border:1px solid var(--gold);border-radius:8px;transition:.3s">üë§ Admin Telegram</a>
        <a href="https://tiktok.com/@tradersxauusd" target="_blank" rel="noopener noreferrer" style="color:var(--gold);font-weight:600;text-decoration:none;padding:10px 14px;border:1px solid var(--gold);border-radius:8px;transition:.3s">üéµ TikTok</a>
        <a href="https://youtube.com/tradersxauusd" target="_blank" rel="noopener noreferrer" style="color:var(--gold);font-weight:600;text-decoration:none;padding:10px 14px;border:1px solid var(--gold);border-radius:8px;transition:.3s">‚ñ∂Ô∏è YouTube</a>
      </div>
    </div>
  </div>
</div>

<footer class="fade-in" style="margin-top:18px">¬© 2025 TradersXauusd | Jurnal Trading Emas</footer>

<div class="support-banner" id="supportBanner">
  <img src="/icon-192.png" alt="Support TradersXauusd">
  <div class="text"><strong>Dukung Pengembang</strong><span>Bantu kembangkan fitur & server TradersXauusd üíõ</span></div>
  <a href="http://lynk.id/tradersxauusd/s/gg485q0k32gp?utm_source=site&utm_medium=banner&utm_campaign=support_tradersxauusd" target="_blank" rel="noopener noreferrer nofollow">
    <button class="btn">Dukung Sekarang</button>
  </a>
</div>

<script>
(function makeStars(){const c=document.querySelector('.stars'),n=90;for(let i=0;i<n;i++){const s=document.createElement('div');s.className='star';const z=Math.random()*2+0.6;s.style.width=z+'px';s.style.height=z+'px';s.style.left=Math.random()*100+'%';s.style.top=Math.random()*100+'%';s.style.opacity=(Math.random()*0.6+0.2).toString();s.style.animationDelay=(Math.random()*6)+'s';c.appendChild(s)}})();

window.addEventListener("load",()=>{const slides=document.querySelectorAll(".banner-slide");if(!slides||slides.length===0)return;let idx=0;slides.forEach(s=>s.classList.remove('active'));slides[idx].classList.add("active");setInterval(()=>{slides[idx].classList.remove("active");idx=(idx+1)%slides.length;slides[idx].classList.add("active")},6000)});

let trades=JSON.parse(localStorage.getItem('trades')||'[]'),showAllTrades=false;
function generateId(){return 'id-'+([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,c=>(c^crypto.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16))}

const tradeTable=document.getElementById('tradeTable'),weeklyTotal=document.getElementById('weeklyTotal'),weeklyRate=document.getElementById('weeklyRate'),weeklyTrades=document.getElementById('weeklyTrades'),weeklyWins=document.getElementById('weeklyWins'),weeklyLoss=document.getElementById('weeklyLoss'),monthlyPips=document.getElementById('monthlyPips'),monthlyRate=document.getElementById('monthlyRate'),monthlyTrades=document.getElementById('monthlyTrades'),monthSelect=document.getElementById('monthSelect'),yearSelect=document.getElementById('yearSelect');

function populateMonthYear(){const months=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];months.forEach((m,i)=>{const o=document.createElement('option');o.value=i;o.textContent=m;monthSelect.appendChild(o)});const now=new Date(),cy=now.getFullYear();for(let y=cy;y>=cy-5;y--){const o=document.createElement('option');o.value=y;o.textContent=y;yearSelect.appendChild(o)}monthSelect.value=now.getMonth();yearSelect.value=now.getFullYear()}
populateMonthYear();

function calcPips(pair,type,entry,exit){entry=parseFloat(entry);exit=parseFloat(exit);if(isNaN(entry)||isNaN(exit))return "0.0";const m=pair.toUpperCase().includes('XAU')?10:10000;let p=0;if(type.toLowerCase()==='buy')p=(exit-entry)*m;else if(type.toLowerCase()==='sell')p=(entry-exit)*m;return p.toFixed(1)}

function attachPipsListeners(){['pair','tipe','entry','exit'].forEach(id=>{const el=document.getElementById(id);if(el&&!el._pipsAttached){el.addEventListener('input',updateAutoPips);el.addEventListener('change',updateAutoPips);el._pipsAttached=true}})}

let calcTimer;
function updateAutoPips(){clearTimeout(calcTimer);calcTimer=setTimeout(()=>{const pair=document.getElementById('pair').value||'XAUUSD',type=document.getElementById('tipe').value||'buy',entry=document.getElementById('entry').value,exit=document.getElementById('exit').value,p=calcPips(pair,type,entry,exit),pipsEl=document.getElementById('pips');if(pipsEl)pipsEl.value=p},180)}

const btnCalc=document.getElementById('calcBtn');
if(btnCalc)btnCalc.addEventListener('click',updateAutoPips);

document.getElementById('clearBtn').addEventListener('click',()=>{if(confirm('Hapus semua data jurnal?')){trades=[];localStorage.removeItem('trades');renderTrades();updateAll()}});

function renderTrades(){if(!tradeTable)return;tradeTable.innerHTML='';if(!trades||trades.length===0){tradeTable.innerHTML='<tr><td colspan="8" style="text-align:center;color:#777">Belum ada data trading</td></tr>';return}const dataToShow=showAllTrades?trades.slice().reverse():trades.slice(-10).reverse();dataToShow.forEach(t=>{const tr=document.createElement('tr');tr.className='trade-row';const pipsColor=t.pips>0?'#00ff7f':(t.pips<0?'#ff4757':'#ffd65a');tr.innerHTML=`<td>${t.date}</td><td style="color:#ffd65a;font-weight:600">${t.pair}</td><td style="text-transform:uppercase">${t.type}</td><td>${t.entry}</td><td>${t.exit}</td><td style="color:${pipsColor};font-weight:700">${t.pips>0?'+':''}${t.pips}</td><td style="font-size:0.88rem;color:#ccc">${t.note||'-'}</td><td><button class="deleteBtn" data-id="${t.id}" style="background:#c22223;color:#fff;border:none;border-radius:5px;padding:6px 10px;cursor:pointer;font-weight:600;transition:0.2s" onmouseover="this.style.background='#e83838'" onmouseout="this.style.background='#c22323'">üóëÔ∏è</button></td>`;tradeTable.appendChild(tr)});attachDeleteHandlers()}

function attachDeleteHandlers(){document.querySelectorAll('.deleteBtn').forEach(btn=>{const newBtn=btn.cloneNode(true);btn.parentNode.replaceChild(newBtn,btn)});document.querySelectorAll('.deleteBtn').forEach(btn=>{btn.addEventListener('click',async e=>{e.preventDefault();e.stopPropagation();const id=e.currentTarget.getAttribute('data-id');if(!id){console.error('‚ùå ID tidak ditemukan');return}if(!confirm('Yakin ingin menghapus data ini?'))return;try{if(typeof SupabaseSync!=='undefined'&&SupabaseSync.delete)await SupabaseSync.delete(id);const idx=trades.findIndex(t=>t.id===id);if(idx!==-1){trades.splice(idx,1);localStorage.setItem('trades',JSON.stringify(trades))}renderTrades();updateAll();showToast('üóëÔ∏è Data berhasil dihapus');console.log('‚úÖ Data dihapus:',id)}catch(err){console.error('‚ùå Gagal hapus data:',err);showToast('‚ùå Gagal menghapus data')}})})}

document.getElementById("filterBtn").addEventListener("click",()=>{const start=document.getElementById("startDate").value,end=document.getElementById("endDate").value;if(!start||!end){alert("Pilih tanggal mulai dan tanggal akhir terlebih dahulu!");return}const filtered=trades.filter(t=>t.date>=start&&t.date<=end);renderFilteredTrades(filtered);updateSummary(filtered);createCharts(filtered)});

document.getElementById("resetFilter").addEventListener("click",()=>{renderTrades();updateAll()});

function renderFilteredTrades(data){if(!tradeTable)return;tradeTable.innerHTML="";if(!data||data.length===0){tradeTable.innerHTML=`<tr><td colspan="8" style="text-align:center;color:#777">Tidak ada data dalam rentang tanggal</td></tr>`;return}data.slice().reverse().forEach(t=>{const pipsColor=t.pips>0?'#00ff7f':(t.pips<0?'#ff4757':'#ffd65a'),tr=document.createElement("tr");tr.className='trade-row';tr.innerHTML=`<td>${t.date}</td><td style="color:#ffd65a;font-weight:600">${t.pair}</td><td style="text-transform:uppercase">${t.type}</td><td>${t.entry}</td><td>${t.exit}</td><td style="color:${pipsColor};font-weight:700">${t.pips>0?'+':''}${t.pips}</td><td style="font-size:0.88rem;color:#ccc">${t.note||'-'}</td><td><button class="deleteBtn" data-id="${t.id}" style="background:#c22223;color:#fff;border:none;border-radius:5px;padding:6px 10px;cursor:pointer;font-weight:600">üóëÔ∏è</button></td>`;tradeTable.appendChild(tr)});attachDeleteHandlers()}

document.addEventListener('DOMContentLoaded',()=>{attachPipsListeners();const toggleBtn=document.createElement('button');toggleBtn.textContent='üîÑ Lihat Semua Trade';toggleBtn.className='btn-calc fade-in toggle-float';toggleBtn.style.position='relative';toggleBtn.style.display='block';toggleBtn.style.margin='14px auto';toggleBtn.style.padding='12px 18px';toggleBtn.style.fontWeight='700';toggleBtn.style.border='1px solid rgba(212,175,55,0.4)';toggleBtn.style.borderRadius='10px';toggleBtn.style.transition='all 0.3s ease';toggleBtn.style.background='linear-gradient(90deg, #1a1a1a, #111)';toggleBtn.style.color='#ffd65a';toggleBtn.style.cursor='pointer';toggleBtn.style.boxShadow='0 0 12px rgba(212,175,55,0.2)';toggleBtn.style.fontSize='1rem';toggleBtn.style.textAlign='center';toggleBtn.style.maxWidth='320px';toggleBtn.style.minWidth='200px';toggleBtn.style.zIndex='9999';toggleBtn.addEventListener('mouseover',()=>{toggleBtn.style.background='linear-gradient(90deg, #2a2a2a, #1a1a1a)';toggleBtn.style.boxShadow='0 0 25px rgba(212,175,55,0.35)'});toggleBtn.addEventListener('mouseout',()=>{toggleBtn.style.background='linear-gradient(90deg, #1a1a1a, #111)';toggleBtn.style.boxShadow='0 0 12px rgba(212,175,55,0.2)'});toggleBtn.onclick=()=>{showAllTrades=!showAllTrades;renderTrades();toggleBtn.textContent=showAllTrades?'üîô Tampilkan 10 Terakhir':'üîÑ Lihat Semua Trade'};if(tradeTable&&tradeTable.parentNode)tradeTable.parentNode.insertAdjacentElement('afterend',toggleBtn)});

function setSyncStatus(msg,color='#ccc'){const el=document.getElementById('syncStatus');if(el){el.innerHTML=msg;el.style.color=color}}

window.addEventListener('online',()=>setSyncStatus('‚úÖ Online ‚Äì Data tersinkronisasi','#00ff7f'));
window.addEventListener('offline',()=>setSyncStatus('‚ö†Ô∏è Offline ‚Äì Data disimpan lokal','#ff7575'));
setSyncStatus(navigator.onLine?'‚úÖ Online ‚Äì Tersinkron ke cloud':'‚ö†Ô∏è Offline ‚Äì Menyimpan lokal');

let weeklyChart=null,winLossChart=null;
function createCharts(data=trades){const wEl=document.getElementById('weeklyChart'),dEl=document.getElementById('winLossChart');if(!wEl||!dEl)return;const ctxW=wEl.getContext('2d'),ctxD=dEl.getContext('2d');if(weeklyChart)weeklyChart.destroy();if(winLossChart)winLossChart.destroy();const labels=['Sen','Sel','Rab','Kam','Jum','Sab','Min'],pipsData=aggregateWeeklyPips(data);weeklyChart=new Chart(ctxW,{type:'line',data:{labels:labels,datasets:[{label:'Pips Mingguan',data:pipsData,borderColor:'#d4af37',backgroundColor:'rgba(212,175,55,0.12)',fill:true,pointBackgroundColor:'#ffd65a',tension:0.35,pointRadius:4}]},options:{responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#ccc'},grid:{color:'rgba(255,255,255,0.03)'}},y:{ticks:{color:'#ccc'},grid:{color:'rgba(255,255,255,0.03)'}}},animation:{duration:1200,easing:'easeOutCubic'}}});const win=data.filter(t=>t.pips>0).length,loss=data.filter(t=>t.pips<0).length;winLossChart=new Chart(ctxD,{type:'doughnut',data:{labels:['Profit','Loss'],datasets:[{data:[win,loss],backgroundColor:['#00ff7f','#ff4757'],borderWidth:0}]},options:{responsive:true,maintainAspectRatio:false,cutout:'68%',plugins:{legend:{position:'top',labels:{color:'#fff',font:{size:13}}}},animation:{duration:1300,easing:'easeOutBack',animateRotate:true,animateScale:true}}});document.querySelectorAll('.chart-box').forEach(chart=>{chart.style.opacity=0;chart.style.transform='scale(0.9)';setTimeout(()=>{chart.style.transition='opacity 0.9s ease, transform 0.9s ease';chart.style.opacity=1;chart.style.transform='scale(1)'},200)})}

function aggregateWeeklyPips(data=trades){const arr=[0,0,0,0,0,0,0];(data||[]).forEach(t=>{const d=new Date(t.date);if(isNaN(d))return;const weekday=d.getDay(),idx=(weekday===0)?6:(weekday-1);arr[idx]+=Number(t.pips||0)});return arr.map(v=>parseFloat(v.toFixed(1)))}

function updateSummary(data=trades){const totalPips=data.reduce((s,t)=>s+Number(t.pips||0),0),wins=data.filter(t=>t.pips>0).length,losses=data.filter(t=>t.pips<0).length,total=data.length;if(weeklyTotal)weeklyTotal.textContent=totalPips.toFixed(1);if(weeklyRate)weeklyRate.textContent=total?((wins/total)*100).toFixed(1)+'%':'0%';if(weeklyTrades)weeklyTrades.textContent=total;if(weeklyWins)weeklyWins.textContent=wins;if(weeklyLoss)weeklyLoss.textContent=losses}

function populateRekapOptions(){if(!monthSelect||!yearSelect)return;monthSelect.addEventListener('change',updateMonthlyRekap);yearSelect.addEventListener('change',updateMonthlyRekap);updateMonthlyRekap()}

function updateMonthlyRekap(){if(!monthSelect||!yearSelect)return;const month=parseInt(monthSelect.value,10),year=parseInt(yearSelect.value,10),filtered=trades.filter(t=>{const d=new Date(t.date);return d.getMonth()===month&&d.getFullYear()===year}),totalPips=filtered.reduce((s,t)=>s+Number(t.pips||0),0),wins=filtered.filter(t=>t.pips>0).length,losses=filtered.filter(t=>t.pips<0).length,total=filtered.length;if(monthlyPips)monthlyPips.textContent=totalPips.toFixed(1);if(monthlyRate)monthlyRate.textContent=total?((wins/total)*100).toFixed(1)+'%':'0%';if(monthlyTrades)monthlyTrades.textContent=total}

function updateAll(){updateSummary();createCharts();populateRekapOptions()}

renderTrades();updateAll();

window.addEventListener('storage',function(e){if(e.key==='trades'){trades=JSON.parse(localStorage.getItem('trades')||'[]');renderTrades();updateAll()}});

window.addEventListener('resize',function(){if(weeklyChart)weeklyChart.resize();if(winLossChart)winLossChart.resize()});

const tanggalEl=document.getElementById('tanggal');
if(tanggalEl)tanggalEl.value=new Date().toISOString().slice(0,10);

window.addEventListener('load',function(){createCharts();updateAll()});
</script>

<script>
if('serviceWorker' in navigator){navigator.serviceWorker.register('/service-worker.js').then(()=>console.log('‚úÖ Service Worker aktif dan berjalan')).catch(err=>console.log('‚ùå Gagal register Service Worker:',err))}
</script>

<script src="/popup-ads.js"></script>
<script>
window.addEventListener('load',()=>{setTimeout(()=>{if(typeof showPopupAd==='function'){try{showPopupAd()}catch(e){console.warn('popup error',e)}}},7000)});
</script>

<script>
window.addEventListener('load',()=>{const slot=document.getElementById('ad-slot'),fallback=document.getElementById('fallback-banner');if(!slot)return;const s=document.createElement('script');s.src='//suppliesfloored.com/98c09d5670bbd4f632336e1c26536317/invoke.js';s.async=true;s.onload=()=>{console.log('‚úÖ Ad slot aktif');fallback.style.display='none'};s.onerror=()=>{console.log('‚ö†Ô∏è Ad slot gagal dimuat, fallback diaktifkan');fallback.style.display='block'};slot.appendChild(s);setTimeout(()=>{if(!slot.querySelector('iframe')){console.log('‚è≥ Timeout ‚Äì tampilkan fallback banner');fallback.style.display='block'}},6000)});
</script>

<script>
window.addEventListener("load",()=>{const banner=document.getElementById("supportBanner");setTimeout(()=>banner.classList.add("show"),1500);setTimeout(()=>{banner.classList.remove("show");banner.classList.add("hide")},16500)});
</script>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/login/supabase.js"></script>

<script>
(function(){const saveTradeBtnOriginal=document.getElementById('saveTradeBtn');if(saveTradeBtnOriginal){const newSaveBtn=saveTradeBtnOriginal.cloneNode(true);saveTradeBtnOriginal.parentNode.replaceChild(newSaveBtn,saveTradeBtnOriginal);newSaveBtn.addEventListener('click',async function(){updateAutoPips();await new Promise(r=>setTimeout(r,250));const newTrade={id:generateId(),date:document.getElementById('tanggal')?.value||new Date().toISOString().slice(0,10),pair:(document.getElementById('pair')?.value||'XAUUSD').toUpperCase(),type:document.getElementById('tipe')?.value||'buy',entry:document.getElementById('entry')?.value||'',exit:document.getElementById('exit')?.value||'',pips:parseFloat(document.getElementById('pips')?.value)||0,note:document.getElementById('note')?.value||''};if(!newTrade.entry||!newTrade.exit){showToast('‚ö†Ô∏è Entry dan Exit harus diisi!');return}trades.push(newTrade);localStorage.setItem('trades',JSON.stringify(trades));renderTrades();updateAll();if(typeof SupabaseSync!=='undefined'&&SupabaseSync.push){try{const result=await SupabaseSync.push(newTrade);if(result&&result.id){newTrade.id=result.id;const idx=trades.length-1;trades[idx]=newTrade;localStorage.setItem('trades',JSON.stringify(trades))}showToast("‚òÅÔ∏è Trade tersimpan & tersinkron!")}catch(err){console.warn("‚ö†Ô∏è Sync error:",err);showToast("üíæ Trade disimpan (offline mode)")}}else{showToast("üíæ Trade disimpan lokal")}document.getElementById('entry').value='';document.getElementById('exit').value='';document.getElementById('pips').value='';document.getElementById('note').value='';this.blur()})}})();

(async()=>{console.log('üîê Memulai auth check...');document.body.style.opacity="0";document.body.style.transition="opacity 0.5s ease";let attempts=0;while(!window.supabaseClient&&attempts<30){await new Promise(r=>setTimeout(r,100));attempts++}if(!window.supabaseClient){console.error('‚ùå Supabase client tidak tersedia setelah 3 detik');document.body.style.opacity="1";showToast('‚ö†Ô∏è Gagal terhubung ke server - mode offline');return}console.log('‚úÖ Supabase client ready');await new Promise(r=>setTimeout(r,500));try{const{data,error}=await supabaseClient.auth.getSession();if(error){console.error('‚ùå Auth error:',error);throw error}const session=data?.session;if(window.location.pathname.endsWith("/index.html"))history.replaceState(null,"","/");if(session?.user){const user=session.user;console.log("‚úÖ User authenticated:",user.email);const syncStatus=document.getElementById("syncStatus");if(syncStatus){syncStatus.innerHTML=`‚òÅÔ∏è ${user.email.split('@')[0]}`;syncStatus.style.background="linear-gradient(90deg, #00ff7f, #00e676)";syncStatus.style.color="#000"}document.body.style.opacity="1";if(typeof SupabaseSync!=='undefined'&&SupabaseSync.fetchAll){setTimeout(async()=>{try{const cloudData=await SupabaseSync.fetchAll();if(cloudData&&cloudData.length>0){trades=cloudData.map(r=>({id:r.id,date:r.trade_date,pair:r.pair,type:r.type,entry:r.entry,exit:r.exit,pips:Number(r.pips),note:r.note||''}));localStorage.setItem('trades',JSON.stringify(trades));renderTrades();updateAll();showToast(`‚òÅÔ∏è ${trades.length} data dimuat dari cloud`)}}catch(err){console.error('‚ùå Gagal load cloud data:',err)}},800)}}else{console.warn("‚ö†Ô∏è User belum authenticated");if(!window.location.pathname.startsWith("/login")){console.log("‚Ü™Ô∏è Redirect ke /login/");window.location.replace("/login/")}}}catch(err){console.error("‚ùå Critical auth error:",err);if(!window.location.pathname.startsWith("/login"))window.location.replace("/login/")}})();

(function(){if(document.getElementById('logoutBtn'))return;const h1=document.querySelector('h1');if(h1){const logoutDiv=document.createElement('div');logoutDiv.style.textAlign='center';logoutDiv.style.margin='10px 0';logoutDiv.innerHTML=`<button id="logoutBtn" style="background:#ff4757;color:#fff;border:none;padding:8px 16px;border-radius:8px;cursor:pointer;font-weight:600">üö™ Logout</button>`;h1.insertAdjacentElement('afterend',logoutDiv);document.getElementById('logoutBtn').addEventListener('click',async()=>{if(!confirm('Yakin ingin logout?'))return;try{if(window.supabaseClient)await window.supabaseClient.auth.signOut();localStorage.clear();showToast('üëã Logout berhasil');setTimeout(()=>window.location.href='/login/',1000)}catch(err){console.error('Logout error:',err);showToast('‚ùå Gagal logout')}})}})();

console.log('‚úÖ Critical fixes loaded successfully');
</script>

</body>
</html>
